<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HACKBOOK</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /*
         * Настройки цвета и шрифта
         * Вы можете изменить эти значения для персонализации сайта.
         */
        :root {
            --bg-primary: #1A2C1B;      /* Основной темный фон (темно-зеленый) */
            --bg-secondary: #2C3B2D;    /* Цвет карточек и блоков (другой оттенок зеленого) */
            --text-color: #e2e8f0;      /* Основной цвет текста */
            --accent-color: #3AFF00;    /* Яркий акцентный цвет (неоновый зеленый) */
            --font-family: 'Roboto Mono', monospace;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-primary);
            color: var(--text-color);
        }
        .text-neon-accent {
            color: var(--accent-color);
            text-shadow: 0 0 8px var(--accent-color);
        }
        .bg-card {
            background-color: var(--bg-secondary);
        }
        .btn {
            @apply px-4 py-2 rounded-lg font-medium transition-colors duration-200;
        }
        .btn-primary {
            @apply bg-[var(--accent-color)] hover:bg-green-700 text-black;
        }
        .btn-secondary {
            @apply bg-gray-600 hover:bg-gray-700 text-gray-200;
        }
        .card {
            @apply p-6 bg-card rounded-lg shadow-lg;
        }
        .logo-text {
            font-family: var(--font-family);
            font-weight: 700;
        }
        input, textarea {
            background-color: #213022;
            color: white;
        }
        input::placeholder, textarea::placeholder {
            color: #79917A;
        }
        a {
            color: #4CAF50; /* Зеленый цвет для ссылок */
        }
        a:hover {
            color: #81C784;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">

    <!-- Main Container -->
    <div id="app" class="min-h-screen flex flex-col items-center p-4">

        <!-- Navigation Bar -->
        <header id="nav" class="fixed top-0 left-0 right-0 z-50 flex items-center justify-between p-4 bg-[var(--bg-secondary)] shadow-md">
            <h1 class="text-3xl font-bold text-neon-accent logo-text">HACKBOOK</h1>
            <nav class="flex items-center space-x-4">
                <button class="btn btn-secondary" onclick="showPage('home')">Главная</button>
                <button class="btn btn-secondary" onclick="showPage('profile')">Профиль</button>
                <button class="btn btn-secondary" onclick="showPage('messages')">Сообщения</button>
                <button class="btn btn-secondary" onclick="logout()">Выйти</button>
            </nav>
        </header>
        
        <!-- Welcome/Login Page -->
        <main id="welcome-page" class="flex flex-col items-center justify-center flex-grow w-full max-w-lg mx-auto">
            <div class="card w-full text-center">
                <h2 class="text-4xl font-bold text-neon-accent mb-4">Добро пожаловать в HACKBOOK</h2>
                <p class="text-lg text-gray-400 mb-8">Социальная сеть для тех, кто понимает, что такое байты.</p>
                <form id="login-form" class="space-y-4">
                    <input type="text" id="username" placeholder="Имя пользователя" class="w-full px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--accent-color)]">
                    <input type="password" id="password" placeholder="Пароль" class="w-full px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--accent-color)]">
                    <button type="submit" class="w-full btn btn-primary">Войти</button>
                </form>
                <p class="mt-4 text-sm text-gray-400">
                    Нет аккаунта? <a href="#" id="show-register" class="text-green-400 hover:underline">Зарегистрироваться</a>
                </p>
            </div>
        </main>

        <!-- Register Page -->
        <main id="register-page" class="hidden flex-col items-center justify-center flex-grow w-full max-w-lg mx-auto">
            <div class="card w-full text-center">
                <h2 class="text-4xl font-bold text-neon-accent mb-4">Регистрация</h2>
                <form id="register-form" class="space-y-4">
                    <input type="text" id="new-username" placeholder="Имя пользователя" class="w-full px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--accent-color)]">
                    <input type="password" id="new-password" placeholder="Пароль" class="w-full px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--accent-color)]">
                    <button type="submit" class="w-full btn btn-primary">Зарегистрироваться</button>
                </form>
                <p class="mt-4 text-sm text-gray-400">
                    Уже есть аккаунт? <a href="#" id="show-login" class="text-green-400 hover:underline">Войти</a>
                </p>
            </div>
        </main>
        
        <!-- Home Page (hidden by default) -->
        <main id="home-page" class="hidden flex flex-col flex-grow w-full max-w-4xl pt-20 pb-4">
            <div class="card mb-4">
                <h2 class="text-2xl font-semibold mb-4">Что у вас на уме?</h2>
                <textarea id="new-post-content" placeholder="Напишите что-нибудь..." class="w-full p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--accent-color)] resize-none h-24"></textarea>
                <button id="post-btn" class="mt-4 btn btn-primary">Опубликовать</button>
            </div>

            <div id="posts-container" class="space-y-6">
                <!-- Posts will be dynamically inserted here -->
            </div>
        </main>
        
        <!-- Profile Page (hidden by default) -->
        <main id="profile-page" class="hidden flex flex-col flex-grow w-full max-w-4xl pt-20 pb-4">
            <div class="card text-center mb-6">
                <img id="profile-picture" class="w-32 h-32 rounded-full mx-auto mb-4 border-4 border-neon-accent" src="https://placehold.co/128x128/2d3748/e2e8f0?text=Профиль" alt="Профиль">
                <h2 id="profile-username" class="text-3xl font-bold text-neon-accent mb-2"></h2>
                <p id="profile-bio" class="text-gray-400 italic">"Мы — то, что мы публикуем."</p>
            </div>
            
            <!-- New section to change avatar -->
            <div class="card mb-6">
                <h3 class="text-2xl font-semibold mb-4">Изменить аватар</h3>
                <div class="flex flex-col space-y-4 sm:flex-row sm:space-y-0 sm:space-x-4">
                    <input type="url" id="avatar-url-input" placeholder="Введите URL изображения..." class="flex-grow px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--accent-color)]">
                    <button id="save-avatar-btn" class="btn btn-primary">Сохранить аватар</button>
                </div>
            </div>

            <div class="card">
                <h3 class="text-2xl font-semibold mb-4">Мои посты</h3>
                <div id="my-posts-container" class="space-y-4">
                    <!-- User's posts will be dynamically inserted here -->
                </div>
            </div>
        </main>
        
        <!-- Messages Page (hidden by default) -->
        <main id="messages-page" class="hidden flex flex-col flex-grow w-full max-w-4xl pt-20 pb-4">
            <div class="card h-full flex flex-col">
                <h2 class="text-2xl font-semibold mb-4">Сообщения</h2>
                <div id="messages-list" class="flex-grow overflow-y-auto space-y-4 p-4 rounded-lg bg-[var(--bg-secondary)]">
                    <!-- Messages will be dynamically inserted here -->
                </div>
                <div class="mt-4 flex items-center">
                    <input type="text" id="new-message-input" placeholder="Введите сообщение..." class="flex-grow px-4 py-2 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-[var(--accent-color)]">
                    <button id="send-message-btn" class="btn btn-primary rounded-l-none">Отправить</button>
                </div>
            </div>
        </main>

        <!-- Message/Alert Box -->
        <div id="message-box" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-card p-6 rounded-lg shadow-xl hidden z-50">
            <p id="message-text" class="text-center font-medium"></p>
            <button id="message-box-ok" class="mt-4 w-full btn btn-primary">ОК</button>
        </div>

    </div>

    <script>
        // Placeholder data for demonstration
        let currentUser = null;
        let users = {
            'hacker_1': { password: 'password', bio: 'Люблю взламывать и код, и орехи.', avatarUrl: null },
            'hacker_2': { password: 'pass', bio: 'Привет, мир!', avatarUrl: null }
        };
        let posts = [
            { id: 1, user: 'hacker_1', content: 'Только что обнаружил нулевую уязвимость в этом старом протоколе. ', comments: [] },
            { id: 2, user: 'hacker_2', content: 'Готовимся к CTF. Какие-нибудь советы по реверс-инжинирингу?', comments: [{ user: 'hacker_1', text: 'Начни с IDA Pro, это классика.' }] }
        ];

        // UI elements
        const app = document.getElementById('app');
        const nav = document.getElementById('nav');
        const welcomePage = document.getElementById('welcome-page');
        const registerPage = document.getElementById('register-page');
        const homePage = document.getElementById('home-page');
        const profilePage = document.getElementById('profile-page');
        const messagesPage = document.getElementById('messages-page');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const showRegisterBtn = document.getElementById('show-register');
        const showLoginBtn = document.getElementById('show-login');
        const postsContainer = document.getElementById('posts-container');
        const myPostsContainer = document.getElementById('my-posts-container');
        const newPostContent = document.getElementById('new-post-content');
        const postBtn = document.getElementById('post-btn');
        const profileUsername = document.getElementById('profile-username');
        const profileBio = document.getElementById('profile-bio');
        const messageBox = document.getElementById('message-box');
        const messageText = document.getElementById('message-text');
        const messageBoxOk = document.getElementById('message-box-ok');

        // New elements for avatar
        const avatarUrlInput = document.getElementById('avatar-url-input');
        const saveAvatarBtn = document.getElementById('save-avatar-btn');
        const profilePicture = document.getElementById('profile-picture');

        // Functions to show/hide pages
        function hideAllPages() {
            welcomePage.classList.add('hidden');
            registerPage.classList.add('hidden');
            homePage.classList.add('hidden');
            profilePage.classList.add('hidden');
            messagesPage.classList.add('hidden');
            nav.classList.add('hidden');
        }

        function showPage(pageId) {
            hideAllPages();
            nav.classList.remove('hidden');
            if (pageId === 'home') homePage.classList.remove('hidden');
            if (pageId === 'profile') {
                renderProfile();
                profilePage.classList.remove('hidden');
            }
            if (pageId === 'messages') messagesPage.classList.remove('hidden');
            renderPosts();
        }

        function showMessageBox(text) {
            messageText.textContent = text;
            messageBox.classList.remove('hidden');
        }

        messageBoxOk.addEventListener('click', () => {
            messageBox.classList.add('hidden');
        });

        // Event Listeners for auth pages
        showRegisterBtn.addEventListener('click', (e) => {
            e.preventDefault();
            welcomePage.classList.add('hidden');
            registerPage.classList.remove('hidden');
        });

        showLoginBtn.addEventListener('click', (e) => {
            e.preventDefault();
            registerPage.classList.add('hidden');
            welcomePage.classList.remove('hidden');
        });

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = e.target.username.value;
            const password = e.target.password.value;
            if (users[username] && users[username].password === password) {
                currentUser = username;
                showMessageBox('Вход выполнен успешно!');
                showPage('home');
            } else {
                showMessageBox('Неправильное имя пользователя или пароль!');
            }
        });

        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const newUsername = e.target['new-username'].value;
            const newPassword = e.target['new-password'].value;
            if (users[newUsername]) {
                showMessageBox('Это имя пользователя уже занято!');
            } else {
                users[newUsername] = { password: newPassword, bio: 'Новый пользователь HACKBOOK.', avatarUrl: null };
                showMessageBox('Регистрация прошла успешно! Теперь вы можете войти.');
                registerPage.classList.add('hidden');
                welcomePage.classList.remove('hidden');
            }
        });

        function logout() {
            currentUser = null;
            hideAllPages();
            welcomePage.classList.remove('hidden');
            showMessageBox('Вы вышли из системы.');
        }

        // Functions for rendering content
        function createPostElement(post) {
            const postElement = document.createElement('div');
            postElement.classList.add('card');
            postElement.innerHTML = `
                <div class="flex items-center mb-4">
                    <img class="w-10 h-10 rounded-full mr-4 border border-gray-500" src="${users[post.user].avatarUrl || `https://placehold.co/40x40/2d3748/e2e8f0?text=${post.user.charAt(0).toUpperCase()}`}" alt="Аватар" onerror="this.onerror=null;this.src='https://placehold.co/40x40/2d3748/e2e8f0?text=Ошибка'">
                    <span class="font-bold text-neon-accent">${post.user}</span>
                </div>
                <p class="text-gray-300 mb-4">${post.content}</p>
                <div class="comments space-y-2 border-t border-gray-700 pt-4">
                    <h4 class="font-semibold text-gray-400">Комментарии</h4>
                    <div class="comments-list space-y-2">
                        ${post.comments.map(comment => `
                            <div class="flex items-start">
                                <span class="font-medium text-green-400 mr-2">${comment.user}:</span>
                                <p class="text-sm text-gray-400 flex-grow">${comment.text}</p>
                            </div>
                        `).join('')}
                    </div>
                    <form class="add-comment-form mt-4 flex">
                        <input type="text" placeholder="Добавить комментарий..." class="flex-grow px-3 py-1 rounded-l-lg focus:outline-none focus:ring-1 focus:ring-[var(--accent-color)]">
                        <button type="submit" class="btn btn-primary rounded-l-none text-sm">Отправить</button>
                    </form>
                </div>
            `;
            // Add event listener for new comments
            postElement.querySelector('.add-comment-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const commentInput = e.target.querySelector('input');
                const commentText = commentInput.value;
                if (commentText.trim() !== '' && currentUser) {
                    post.comments.push({ user: currentUser, text: commentText });
                    renderPosts();
                } else if (!currentUser) {
                    showMessageBox('Вы должны войти в систему, чтобы комментировать.');
                }
                commentInput.value = '';
            });
            return postElement;
        }

        function renderPosts() {
            postsContainer.innerHTML = '';
            myPostsContainer.innerHTML = '';
            posts.forEach(post => {
                const postElement = createPostElement(post);
                postsContainer.appendChild(postElement);
                if (post.user === currentUser) {
                    myPostsContainer.appendChild(createPostElement(post));
                }
            });
        }

        postBtn.addEventListener('click', () => {
            const content = newPostContent.value.trim();
            if (content !== '' && currentUser) {
                const newPost = {
                    id: posts.length + 1,
                    user: currentUser,
                    content: content,
                    comments: []
                };
                posts.unshift(newPost); // Add to the beginning of the list
                newPostContent.value = '';
                renderPosts();
            } else if (!currentUser) {
                showMessageBox('Вы должны войти в систему, чтобы публиковать.');
            }
        });

        function renderProfile() {
            if (currentUser) {
                profileUsername.textContent = currentUser;
                profileBio.textContent = users[currentUser].bio;
                if (users[currentUser].avatarUrl) {
                    profilePicture.src = users[currentUser].avatarUrl;
                    profilePicture.onerror = function() {
                        this.src = `https://placehold.co/128x128/2d3748/e2e8f0?text=Ошибка`;
                    };
                } else {
                    profilePicture.src = `https://placehold.co/128x128/2d3748/e2e8f0?text=${currentUser.charAt(0).toUpperCase()}`;
                }
            }
        }
        
        // Event listener for saving the new avatar URL
        saveAvatarBtn.addEventListener('click', () => {
            const newAvatarUrl = avatarUrlInput.value.trim();
            if (newAvatarUrl) {
                users[currentUser].avatarUrl = newAvatarUrl;
                renderProfile();
                showMessageBox('Аватар обновлен!');
            } else {
                showMessageBox('Пожалуйста, введите корректный URL.');
            }
        });

        // Initial render
        hideAllPages();
        welcomePage.classList.remove('hidden');
    </script>
</body>
</html>
